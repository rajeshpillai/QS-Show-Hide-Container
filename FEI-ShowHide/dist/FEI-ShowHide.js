"use strict";define(["js/qlik","./properties","./libs/picomodal","css!./libs/styles.css"],function(t,e,o){var n={initialProperties:{conditionalVis:[],defaultMasterObject:""},support:{exportData:!0,snapshot:!0},definition:e,template:'<div style="display:block;  width:100%; height:100%; overflow:visible;"></div>',controller:function(e,o){function r(t){var o=t.map(function(t){return+t.condition}),n=o.reduce(function(t,e){return t+e},0);return 1==n?t[o.indexOf(1)].conditionalMasterObject?t[o.indexOf(1)].conditionalMasterObject.split("|")[1]:null:e.component.model.layout.defaultMasterObject?e.component.model.layout.defaultMasterObject.split("|")[1]:null}function i(){null==e.currentChartModel?e.app.getObject(o.find("div"),e.currentChart).then(function(t){e.currentChartModel=t}):e.currentChartModel.enigmaModel.endSelections(!0).then(l).then(function(){e.app.getObject(o.find("div"),e.currentChart).then(function(t){e.currentChartModel=t})})}function l(){return e.app.destroySessionObject(e.currentChartModel.layout.qInfo.qId).then(function(){return e.currentChartModel.close()}).then(function(){e.currentChartModel=null})}$(".qv-object .qv-inner-object").css("overflow","visible"),e.app=t.currApp(),n.app=t.currApp(),e.currentChart=r(e.component.model.layout.conditionalVis),e.currentChartModel=null;var c=r(e.component.model.layout.conditionalVis);n.chartId=c,e.currentChart&&i(),e.component.model.Validated.bind(function(){$(".qv-object .qv-inner-object").css("overflow","visible");var t=r(e.component.model.layout.conditionalVis);console.info("chart:",t),console.info(JSON.stringify(t)),e.app.visualization.get(t).then(function(e){console.info("Found chart with ID: ",t),console.info("Viz: ",e),n.chartId=t}),t&&t!==e.currentChart?(e.currentChart=t,i()):t||t===e.currentChart?t||t!==e.currentChart||(e.currentChartModel=null):e.currentChartModel&&(e.currentChart=null,l())})},paint:function(e,o){return t.Promise.resolve()},resize:function(){return!1},getExportRawDataOptions:function(t,e,o){return console.log("c: ",e),n.c=e,t.addItem({translation:"contextMenu.export",tid:"export",icon:"icon-toolbar-sharelist",select:function(){console.log("About to export...",n.c.model),n.export(n.c.model)}}),void o.resolve()},export:function(t){var e={download:!0,filename:t.layout.title},o=window.location.port;n.app.visualization.get(n.chartId).then(function(t){t.table.exportData(e,function(t){console.log("Download Path: ",t);var e="http://localhost:"+o+t;n.showDialog(e)})})},showDialog:function(t){o({content:"<div style='min-width:400px;font-size:1.3em'><h3>EXPORT</h3><p>Data successfully exported!</p>Click <a href='"+t+"'>here</a> to download.<p class='footer'><button class='ok' style='float:right'>Close</button></p></div>",overlayClose:!1}).afterCreate(function(t){t.modalElem().addEventListener("click",function(e){e.target&&e.target.matches(".ok")?t.close(!0):e.target&&e.target.matches(".cancel")&&t.close()})}).show()}};return n});